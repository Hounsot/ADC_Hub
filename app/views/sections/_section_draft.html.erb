<%= form_with model: section, url: user_section_path(section.user, section), method: :patch, data: { controller: "section-create-card", "section-create-card-target": "cardsContainer"  }, html: { class: "M_UserCards" } do |form| %>
  <div class="A_UserCard U_Divider">
    <%= form.text_field :title, class: "A_CardsSectionTitle U_Input " %>
    <div class="W_CardButtons">
      <%= button_tag type: 'submit', class: "A_CardButton U_Color" do %>
        <img src="../images/Q_CardMarkIcon.svg" alt="">
      <% end %>
    </div>
  </div>
  <%= form.fields_for :cards, section.cards.order(:position) do |card_fields| %>
    <% card = card_fields.object %>
    <!-- это объект Card, который редактируем -->
    <% case card.card_type %>
    <% when "text" %>
      <div class="A_UserCard U_Square <%= card.size == 'medium' ? 'U_Medium' : 'U_Square' %>">
        <%= render "cards/forms/form_text_card", f: card_fields %>
      </div>
    <% when "image" %>
      <div class="A_UserCard U_Square U_Image <%= card.size == 'medium' ? 'U_Medium' : 'U_Square' %>">
        <%= render "cards/forms/form_image_card", f: card_fields %>
      </div>
    <% when "job" %>
      <%= render "cards/forms/form_job_card", f: card_fields %>
    <% when "link" %>
      <div class="A_UserCard U_Square <%= card.size == 'medium' ? 'U_Medium' : 'U_Square' %>">
        <div class="W_LinkCardForm">
          <div class="W_LinkFormInputs">
            <%= render "cards/forms/form_link_card", f: card_fields %>
          </div>
        </div>
      </div>
    <% else %>
      <!-- fallback -->
      <%= render "cards/forms/form_unknown_card", f: card_fields %>
    <% end %>
  <% end %>
  <div class="buttons">
    <button data-action="click->section-create-card#addTextCard">Add Text Card</button>
    <button data-action="click->section-create-card#addImageCard">Add Image Card</button>
    <button data-action="click->section-create-card#addLinkCard">Add Link Card</button>
  </div>
  <!-- Hidden partials for new cards (templates) -->
  <%= render "cards/forms/new_text_card_fields",  section: @section, form: form %>
  <%= render "cards/forms/new_image_card_fields", section: @section, form: form %>
  <%= render "cards/forms/new_link_card_fields",  section: @section, form: form %>
<% end %>